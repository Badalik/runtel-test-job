<app-table-filter
  [columns]="columns()"
  (valueChanged)="changeFilter($event)"
></app-table-filter>

<div class="table">
  <table
    mat-table
    matSort
    [dataSource]="dataSource"
  >
    @for (column of columns(); track $index) {
      <ng-container [matColumnDef]="column.name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ column.label }}</th>

        <td mat-cell *matCellDef="let row">
          @let value = row.data[column.name];
          @let additional = column.additional ?? '';

          @if (row.edit) {
            <mat-form-field>
              @if (column.type === columnType.TEXT) {
                <input
                  matInput
                  [(ngModel)]="row.data[column.name]"
                  type="text"
                >
              }

              @if (column.type === columnType.INTEGER) {
                <input
                  matInput
                  [(ngModel)]="row.data[column.name]"
                  type="number"
                >
              }

              @if (column.type === columnType.FLOAT) {
                <input
                  matInput
                  [(ngModel)]="row.data[column.name]"
                  type="number"
                  step="0.1"
                >
              }

              @if (column.type === columnType.DATE) {
                <input
                  matInput
                  [(ngModel)]="row.data[column.name]"
                  type="date"
                >
              }
            </mat-form-field>
          }

          @if (!row.edit) {
            @if (column.type === columnType.DATE) {
              {{ value !== null ? (value | date:'dd.MM.yyyy') : '-' }}
            } @else {
              {{ value !== null ? value + additional : '-' }}
            }
          }
        </td>
      </ng-container>
    }

    @if (editable()) {
      <ng-container matColumnDef="edit">
        <th mat-header-cell *matHeaderCellDef>edit</th>

        <td mat-cell *matCellDef="let row">
          @if (row.edit) {
            <button mat-icon-button (click)="saveRow(row)">
              <mat-icon>check</mat-icon>
            </button>
          } @else {
            <button mat-icon-button (click)="editRow(row)">
              <mat-icon>edit</mat-icon>
            </button>
          }
        </td>
      </ng-container>
    }

    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>
</div>
